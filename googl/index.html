<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plotly Chart with Cache</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <div class="container mt-5">
    <div id="chart"></div>
  </div>

  <script>
    const apiUrl = 'https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=googl&apikey=XVYHOWRTRNPN3FJA'; 

    async function fetchDataAndPlot() {
      let cachedData = localStorage.getItem('chartData');

      if (cachedData) {
        // Use cached data if available
        console.log('Using cached data');
        plotChart(JSON.parse(cachedData));
      } else {
        console.log('Fetching data from API');
        try {
          const response = await fetch(apiUrl);
          const data = await response.json();

          // Cache the data
          localStorage.setItem('chartData', JSON.stringify(data));

          plotChart(data);
        } catch (error) {
          console.error('Error fetching data:', error);
        }
      }
    }

    function plotChart(data) {
      const dates = Object.keys(data['Time Series (Daily)']).reverse();
      const closingPrices = dates.map(date => parseFloat(data['Time Series (Daily)'][date]['4. close']));

      const trace = {
        x: dates,
        y: closingPrices,
        type: 'scatter',
        mode: 'lines',
        name: 'GOOGL Closing Price'
      };

      const layout = {
        title: 'GOOGL Daily Closing Prices',
        xaxis: { title: 'Date' },
        yaxis: { title: 'Price' }
      };

      Plotly.newPlot('chart', [trace], layout);
    }

    fetchDataAndPlot();
  </script>
</body>
</html>
