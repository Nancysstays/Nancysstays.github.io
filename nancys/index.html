<!DOCTYPE html>
<html>
<head>
  <title>Cartesian Plot with CRUD</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

  <div id="plot"></div>

  <h2>Add Line</h2>
  X: <input type="text" id="xInput" placeholder="Enter x values (comma-separated)"> 
  Y: <input type="text" id="yInput" placeholder="Enter y values (comma-separated)"> 
  Color: <input type="color" id="colorInput" value="#007bff"> 
  <button onclick="addLine()">Add Line</button>

  <h2>Lines</h2>
  <ul id="lineList"></ul>

  <h2>Range</h2>
  X-axis: <input type="text" id="xRangeStart" placeholder="Start"> - 
          <input type="text" id="xRangeEnd" placeholder="End">
  Y-axis: <input type="text" id="yRangeStart" placeholder="Start"> - 
          <input type="text" id="yRangeEnd" placeholder="End">
  <button onclick="updateRange()">Update Range</button>

  <button onclick="saveState()">Save State</button>
  <button onclick="loadState()">Load State</button>

  <script>
    let data = [];
    let counter = 1;
    let layout = {}; // Store layout for saving state

    Plotly.newPlot('plot', data);

    function addLine() {
      let xStr = document.getElementById('xInput').value;
      let yStr = document.getElementById('yInput').value;
      let color = document.getElementById('colorInput').value;

      if (!xStr || !yStr) {
        alert("Please enter x and y values.");
        return;
      }

      let xValues = xStr.split(',').map(Number);
      let yValues = yStr.split(',').map(Number);

      let newLine = {
        x: xValues,
        y: yValues,
        type: 'scatter',
        mode: 'lines+markers',
        name: 'Line ' + counter,
        line: {
          shape: 'linear',
          color: color // Use the selected color
        }
      };

      data.push(newLine);
      counter++;

      Plotly.react('plot', data);
      addLineToList(newLine);

      document.getElementById('xInput').value = '';
      document.getElementById('yInput').value = '';
    }

    function addLineToList(line) {
      // ... (same as before)
    }

    function editLine(lineName) {
      // ... (same as before)
    }

    function deleteLine(lineName) {
      // ... (same as before)
    }

    function updateRange() {
      let xStart = parseFloat(document.getElementById('xRangeStart').value);
      let xEnd = parseFloat(document.getElementById('xRangeEnd').value);
      let yStart = parseFloat(document.getElementById('yRangeStart').value);
      let yEnd = parseFloat(document.getElementById('yRangeEnd').value);

      layout.xaxis = { range: [xStart, xEnd] };
      layout.yaxis = { range: [yStart, yEnd] };

      Plotly.react('plot', data, layout);
    }

    function saveState() {
      let state = {
        data: data,
        layout: layout 
      };
      localStorage.setItem('chartState', JSON.stringify(state));
    }

    function loadState() {
      let savedState = localStorage.getItem('chartState');
      if (savedState) {
        let state = JSON.parse(savedState);
        data = state.data;
        layout = state.layout;
        counter = data.length + 1; // Update counter based on loaded data
        Plotly.react('plot', data, layout); 

        // Repopulate the line list
        let lineList = document.getElementById('lineList');
        lineList.innerHTML = ''; // Clear the list
        data.forEach(line => addLineToList(line));
      }
    }
  </script>

</body>
</html>
