<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Menu with IndexedDB</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <style>
        body {
            padding: 20px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Dynamic Menu</h1>

        <div class="input-group mb-3">
            <input type="text" id="new-link-name" class="form-control" placeholder="Link name">
            <input type="text" id="new-link-url" class="form-control" placeholder="Link URL">
            <div class="input-group-append">
                <button class="btn btn-primary" type="button" id="add-link">Add Link</button>
            </div>
        </div>

        <ul class="list-group" id="menu-list">
            </ul>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
    <script>
        const menuList = document.getElementById('menu-list');
        const addLinkButton = document.getElementById('add-link');
        const newLinkNameInput = document.getElementById('new-link-name');
        const newLinkUrlInput = document.getElementById('new-link-url');

        let db;

        // Open IndexedDB
        const request = window.indexedDB.open('menuDB', 1);

        request.onerror = function(event) {
            console.error('IndexedDB error:', event.target.errorCode);
        };

        request.onsuccess = function(event) {
            db = event.target.result;
            loadMenu();
        };

        request.onupgradeneeded = function(event) {
            const db = event.target.result;
            const objectStore = db.createObjectStore('links', { keyPath: 'id', autoIncrement: true });
            objectStore.createIndex('name', 'name', { unique: false });
            objectStore.createIndex('url', 'url', { unique: false });
        };

        // Load menu from IndexedDB
        function loadMenu() {
            menuList.innerHTML = ''; // Clear existing list

            const transaction = db.transaction(['links'], 'readonly');
            const objectStore = transaction.objectStore('links');
            const request = objectStore.getAll();

            request.onsuccess = function(event) {
                const links = event.target.result;
                links.forEach(link => {
                    addLinkToMenu(link);
                });
            };
        }

        // Add link to menu (both UI and IndexedDB)
        function addLinkToMenu(link) {
            const listItem = document.createElement('li');
            listItem.classList.add('list-group-item');
            listItem.innerHTML = `
                <a href="${link.url}" target="_blank">${link.name}</a>
                <div class="float-right">
                    <button class="btn btn-sm btn-warning edit-link" data-id="${link.id}">Edit</button>
                    <button class="btn btn-sm btn-danger delete-link" data-id="${link.id}">Delete</button>
                </div>
            `;
            menuList.appendChild(listItem);

            // Add event listeners for edit and delete buttons
            const editButton = listItem.querySelector('.edit-link');
            const deleteButton = listItem.querySelector('.delete-link');

            editButton.addEventListener('click', () => editLink(link.id));
            deleteButton.addEventListener('click', () => deleteLink(link.id));
        }

        // Add new link
        addLinkButton.addEventListener('click', () => {
            const name = newLinkNameInput.value;
            const url = newLinkUrlInput.value;

            const transaction = db.transaction(['links'], 'readwrite');
            const objectStore = transaction.objectStore('links');
            const request = objectStore.add({ name, url });

            request.onsuccess = function(event) {
                const newLink = { id: event.target.result, name, url };
                addLinkToMenu(newLink);
                newLinkNameInput.value = '';
                newLinkUrlInput.value = '';
            };
        });

        // Edit link
        function editLink(id) {
            // Prompt the user for the new link name and URL (you can use a modal for better UX)
            const newName = prompt("Enter the new link name:");
            const newUrl = prompt("Enter the new link URL:");

            if (newName && newUrl) {
                const transaction = db.transaction(['links'], 'readwrite');
                const objectStore = transaction.objectStore('links');
                const request = objectStore.get(id);

                request.onsuccess = function(event) {
                    const link = event.target.result;
                    link.name = newName;
                    link.url = newUrl;

                    const updateRequest = objectStore.put(link);
                    updateRequest.onsuccess = function() {
                        // Update the link in the UI
                        loadMenu(); // Simpler way to refresh the entire menu
                    };
                };
            }
        }

        // Delete link
        function deleteLink(id) {
            const transaction = db.transaction(['links'], 'readwrite');
            const objectStore = transaction.objectStore('links');
            const request = objectStore.delete(id);

            request.onsuccess = function() {
                // Remove the link from the UI
                loadMenu(); // Simpler way to refresh the entire menu
            };
        }
    </script>

</body>
</html>
