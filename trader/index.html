<!DOCTYPE html>
<html>
<head>
<title>Alpha Vantage Stock Analysis</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
  /* Add custom CSS styles here */
  body {
    font-family: 'Amatic SC', cursive;
    margin: 20px;
  }
  #analysis {
    margin-top: 20px;
  }
  .chart-container {
    margin-top: 20px;
  }
</style>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h1 style="font-family: 'Amatic SC', cursive;">Alpha Vantage Stock Analysis</h1>
    <div class="input-group mb-3">
      <input type="text" class="form-control" id="symbolInput" placeholder="Enter stock symbol (e.g., IBM)">
      <button class="btn btn-primary" onclick="analyzeStock()">Analyze</button>
    </div>

    <div id="analysis"></div>
    <div class="chart-container">
      <div id="myPlot"></div>
    </div>
  </div>

  <script>
    const apiKey = 'XVYHOWRTRNPN3FJA';  // Replace with your actual API key

    async function analyzeStock() {
      const symbol = document.getElementById('symbolInput').value;

      const timeSeriesUrl = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${apiKey}`;
      const dailyData = await fetch(timeSeriesUrl)
        .then(response => response.json())
        .then(data => data['Time Series (Daily)']);

      const djiUrl = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=DJI&apikey=${apiKey}`;
      const djiData = await fetch(djiUrl)
        .then(response => response.json())
        .then(data => data['Time Series (Daily)']);

      const { macd, signal, histogram } = calculateMACD(dailyData);
      const stochastics = calculateStochastic(dailyData);
      const standardDeviation = calculateStandardDeviation(dailyData);
      const covariance = calculateCovariance(dailyData, djiData);

      // ... (rest of the code, including analysis)

      const analysisDiv = document.getElementById('analysis');
      analysisDiv.innerHTML = `
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">${symbol} Analysis</h5>
            <p class="card-text">MACD: ${macd.slice(-1)[0]}</p>
            <p class="card-text">Signal: ${signal.slice(-1)[0]}</p>
            <p class="card-text">Histogram: ${histogram.slice(-1)[0]}</p>
            <p class="card-text">Stochastic K: ${stochastics.slice(-1)[0].k}</p>
            <p class="card-text">Stochastic D: ${stochastics.slice(-1)[0].d}</p>
            <p class="card-text">Standard Deviation: ${standardDeviation}</p>
            <p class="card-text">Covariance with DJI: ${covariance}</p>
          </div>
        </div>
      `;

      // Prepare data for Plotly chart
      const dates = Object.keys(dailyData);
      const prices = Object.values(dailyData).map(data => data['4. close']);

      const trace1 = {
        x: dates,
        y: prices,
        type: 'scatter',
        mode: 'lines+markers',
        name: symbol
      };

      const layout = {
        title: `${symbol} Stock Price`,
        xaxis: {
          title: 'Date'
        },
        yaxis: {
          title: 'Price'
        }
      };

      Plotly.newPlot('myPlot', [trace1], layout);
    }

    // Function to calculate MACD
    function calculateMACD(data) {
      const prices = Object.values(data).map(d => parseFloat(d['4. close']));

      const shortEMA = calculateEMA(prices, 12);
      const longEMA = calculateEMA(prices, 26);
      const macd = shortEMA.map((value, index) => value - longEMA[index]);
      const signal = calculateEMA(macd, 9);
      const histogram = macd.map((value, index) => value - signal[index]);

      return { macd, signal, histogram };
    }

    // Function to calculate Exponential Moving Average (EMA)
    function calculateEMA(prices, period) {
      const ema = [];
      ema[0] = prices[0];

      for (let i = 1; i < prices.length; i++) {
        const multiplier = 2 / (period + 1);
        ema[i] = (prices[i] - ema[i - 1]) * multiplier + ema[i - 1];
      }

      return ema;
    }

    // Function to calculate Stochastic Oscillator
    function calculateStochastic(data) {
      const prices = Object.values(data).map(d => parseFloat(d['4. close']));
      const lows = Object.values(data).map(d => parseFloat(d['3. Low']));
      const highs = Object.values(data).map(d => parseFloat(d['2. High']));

      const stochastics = [];
      for (let i = 14; i < prices.length; i++) {
        const lowestLow = Math.min(...lows.slice(i - 14, i + 1));
        const highestHigh = Math.max(...highs.slice(i - 14, i + 1));
        const k = (prices[i] - lowestLow) / (highestHigh - lowestLow) * 100;
        const d = (stochastics[i - 1] ? stochastics[i - 1].d : k) * 2 / 3 + k / 3;
        stochastics.push({ k, d });
      }

      return stochastics;
    }

    // Function to calculate Standard Deviation
    function calculateStandardDeviation(data) {
      const prices = Object.values(data).map(d => parseFloat(d['4. close']));
      const mean = prices.reduce((sum, price) => sum + price, 0) / prices.length;
      const variance = prices.reduce((sum, price) => sum + Math.pow(price - mean, 2), 0) / prices.length;
      const standardDeviation = Math.sqrt(variance);
      return standardDeviation;
    }

    // Function to calculate Covariance
    function calculateCovariance(data1, data2) {
      const prices1 = Object.values(data1).map(d => parseFloat(d['4. close']));
      const prices2 = Object.values(data2).map(d => parseFloat(d['4. close']));

      const mean1 = prices1.reduce((sum, price) => sum + price, 0) / prices1.length;
      const mean2 = prices2.reduce((sum, price) => sum + price, 0) / prices2.length;

      const covariance = prices1.reduce((sum, price1, index) => {
        return sum + (price1 - mean1) * (prices2[index] - mean2);
      }, 0) / prices1.length;

      return covariance;
    }
  </script>
</body>
</html>
